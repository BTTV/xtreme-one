!function(){tinymce.create("tinymce.plugins.XtremeContentWidgets",{init:function(e,t){var i=this;i.editor=e,i.url=t,i.init_ready=!1,i.supportedWidgets=e.getParam("xtreme_tinymce_widgets_supported","[]"),i.post_ID=e.getParam("post_ID",!1),i.post_ID&&(i._create_button(),i._create_widget_edit_buttons(),e.onNodeChange.add(function(e,t,n){i._on_node_change(e,t,n)}),e.onMouseDown.add(function(e,t){i.supportedWidgets.permission&&("IMG"==t.target.nodeName&&e.dom.hasClass(t.target,"mcexcontentwidget")?i._show_buttons(t.target,"xf_edit_buttons"):i._hide_buttons())}),e.onBeforeExecCommand.add(function(){i._hide_buttons()}),e.onInit.add(function(e){tinymce.DOM.bind(e.getWin(),"scroll",function(){i._hide_buttons()})}),e.onBeforeSetContent.add(function(e,t){t.content=i._do_widget(t.content)}),e.onPostProcess.add(function(e,t){t.get&&(t.content=i._get_widget(t.content))}),i.supportedWidgets.permission&&(e.addCommand("mceInsertWidget",function(t,n){var d=i._do_widget(n);e.execCommand("mceInsertContent",t,d)}),e.addCommand("mceReplaceWidget",function(t,n){var d=i._do_widget(n);e.execCommand("mceReplaceContent",t,d)})))},_on_node_change:function(e,t,i){var n=this;if("IMG"==i.nodeName&&-1!=e.dom.getAttrib(i,"class").indexOf("mcexcontentwidget")){t.setActive("xtreme_tinymce_widgets",!1),t.setDisabled("xtreme_tinymce_widgets",!0);var d=e.dom.getParent(i,"p");if(d){var o=e.dom.getAttrib(d,"class"),r=new RegExp("align(none|left|right|center)","g").exec(o);if(r){var s=e.dom.getAttrib(i,"title"),a=s.replace(/align=(none|left|right|center)/g,"align="+r[1]);e.dom.setAttrib(i,"title",a),n._define_margin_buttons(e,i),a!=s&&e.execCommand("mceRepaint")}}}else t.setDisabled("xtreme_tinymce_widgets",!1)},_do_widget:function(e){var t=this;return e.replace(/(?:<p>)?\[(xwidgetwordpress|xwidget3rdparty|xwidgetxtreme)([^\]]*)\](?:<\/p>)?/g,function(e,i,n){return t._replace_shortcode(e,i,n)})},_find_attribute_in_content:function(e,t){var i=new RegExp(t+"=([^ ]+)","g").exec(e),n="";return i&&(n=tinymce.DOM.decode(i[1])),n},_replace_shortcode:function(e,t,i){var n,d=this,o=d._find_attribute_in_content(i,"align"),r=d._find_attribute_in_content(i,"width"),s=d._find_attribute_in_content(i,"sidemargins"),a="";return o&&("left"===o&&"off"===s&&(a="margin-right:0;"),"right"===o&&"off"===s&&(a="margin-left:0;"),o="align"+o),r&&"auto"!==r&&(a=a+"width:"+r+";"),a.length>0&&(a=' style="'+a+'"'),n='<p class="'+o+'"'+a+">",n+='<img src="'+d.url+'/img/t.gif" class="mcexcontentwidget mceItem mceTemp mce'+t+' mceItemNoResize mceNonEditable" title="'+t+tinymce.DOM.encode(i)+' " />',n+="</p>"},_get_widget:function(e){function t(e,t){return t=new RegExp(t+'="([^"]+)"',"g").exec(e),t?tinymce.DOM.decode(t[1]):""}return e.replace(/(?:<p[^>]*>)*(<img[^>]+>)(?:<\/p>)*/g,function(e,i){var n=t(i,"class");if(-1!=n.indexOf("mcexcontentwidget")){var d=tinymce.trim(t(i,"title"));return"<p>["+d+"]</p>"}return e})},_create_button:function(){if(this.post_ID){var e=this.post_ID,t=[],i=this.editor;tinymce.each(this.supportedWidgets.mainmenu.submenus,function(n){var d={text:n.title,"class":"mceMenuItemTitle",menu:[]};tinymce.each(n.items,function(t){var n={text:t.title,onclick:function(){i.windowManager.open({file:"admin-ajax.php?action=mce_xcontentwidget&action2=insert&widget_class="+t.widget+"&post_id="+e,width:620,height:500,inline:1,title:t.title},{plugin_url:i.url})}};d.menu.push(n)}),t.push(d)}),i.addButton("xtreme_tinymce_widgets",{text:"Xtreme One",type:"splitbutton",icon:!1,menu:t})}},_create_widget_edit_buttons:function(){if(this.post_ID){var e,t=this,i=tinymce.DOM,n=this.post_ID;if(i.remove("xf_edit_buttons"),t.supportedWidgets.permission){i.add(document.body,"div",{id:"xf_edit_buttons",style:"display:none;"}),e=i.add("xf_edit_buttons","img",{src:t.url+"/img/edit.png",id:"xf_editwidget",width:"24",height:"24",title:t.supportedWidgets.buttons.edit}),tinymce.DOM.bind(e,"mousedown",function(e){var i=tinyMCE.activeEditor,d=i.selection.getNode();if(e.preventDefault(),"IMG"==d.nodeName&&-1!=i.dom.getAttrib(d,"class").indexOf("mcexcontentwidget")){t._hide_buttons();var o=new RegExp("id=(\\d+).(\\d+)","g").exec(i.dom.getAttrib(d,"title")),r=o?tinymce.DOM.decode(o[1]):n,s=o?tinymce.DOM.decode(o[2]):"0";o=new RegExp("align=(none|left|right|center)","g").exec(i.dom.getAttrib(d,"title"));var a=o?tinymce.DOM.decode(o[1]):"none";o=new RegExp("width=([^ ]+)","g").exec(i.dom.getAttrib(d,"title"));var g=o?tinymce.DOM.decode(o[1]):"auto";o=new RegExp("sidemargins=([^ ]+)","g").exec(i.dom.getAttrib(d,"title"));var m=o?tinymce.DOM.decode(o[1]):"on";t.editor.windowManager.open({file:"admin-ajax.php?action=mce_xcontentwidget&action2=update&widget_id="+s+"&post_id="+r+"&align="+a+"&width="+g+"&sidemargins="+m,width:620,height:500,inline:1,title:""},{plugin_url:t.url})}});var d=i.add("xf_edit_buttons","img",{src:t.url+"/img/t.gif",id:"xf_widget_a_left",width:"24",height:"24",title:t.supportedWidgets.buttons.margin_r});tinymce.DOM.bind(d,"mousedown",function(e){var i,n=tinyMCE.activeEditor,d=n.selection.getNode(),o=n.dom.getAttrib(d,"title"),r=new RegExp("sidemargins=([^ ]+)","g").exec(n.dom.getAttrib(d,"title")),s=r?tinymce.DOM.decode(r[1]):"on";e.preventDefault(),"on"==s?(i=o.replace(/sidemargins=([^ ]+)/g,"sidemargins=off"),n.dom.setAttrib(d,"title",i)):(i=o.replace(/sidemargins=([^ ]+)/g,"sidemargins=on"),n.dom.setAttrib(d,"title",i)),t._define_margin_buttons(n,d),n.execCommand("mceRepaint")});var o=i.add("xf_edit_buttons","img",{src:t.url+"/img/t.gif",id:"xf_widget_a_right",width:"24",height:"24",title:t.supportedWidgets.buttons.margin_l});tinymce.DOM.bind(o,"mousedown",function(e){var t,i=this,n=tinyMCE.activeEditor,d=n.selection.getNode(),o=n.dom.getAttrib(d,"title"),r=new RegExp("sidemargins=([^ ]+)","g").exec(n.dom.getAttrib(d,"title")),s=r?tinymce.DOM.decode(r[1]):"on";e.preventDefault(),"on"==s?(t=o.replace(/sidemargins=([^ ]+)/g,"sidemargins=off"),n.dom.setAttrib(d,"title",t)):(t=o.replace(/sidemargins=([^ ]+)/g,"sidemargins=on"),n.dom.setAttrib(d,"title",t)),i._define_margin_buttons(n,d),n.execCommand("mceRepaint")});var r=i.add("xf_edit_buttons","img",{src:t.url+"/img/delete.png",id:"xf_delwidget",width:"24",height:"24",title:t.supportedWidgets.buttons.del});tinymce.DOM.bind(r,"mousedown",function(e){var t=tinyMCE.activeEditor,i=t.selection.getNode();if(e.preventDefault(),"IMG"==i.nodeName&&t.dom.hasClass(i,"mcexcontentwidget")){var n=t.dom.getParent(i,"p");t.dom.remove(n?n:i),t.execCommand("mceRepaint")}})}}},_define_margin_buttons:function(e,t){var i=tinymce.DOM,n=new RegExp("align=(none|left|right|center)","g").exec(e.dom.getAttrib(t,"title")),d=n?tinymce.DOM.decode(n[1]):"none";n=new RegExp("sidemargins=([^ ]+)","g").exec(e.dom.getAttrib(t,"title"));var o=n?tinymce.DOM.decode(n[1]):"on",r=e.dom.getParent(t,"p");switch(i.setStyles("xf_widget_a_left",{display:"none"}),i.setStyles("xf_widget_a_right",{display:"none"}),d){case"left":i.setStyles(" xf_widget_a_left",{display:"inline"}),"off"===o?(i.addClass("xf_widget_a_left","off"),e.dom.setStyles(r,{"margin-left":"","margin-right":"0"})):(i.removeClass("xf_widget_a_left","off"),e.dom.setStyles(r,{"margin-left":"","margin-right":""}));break;case"right":i.setStyles("xf_widget_a_right",{display:"inline"}),"off"===o?(i.addClass("xf_widget_a_right","off"),e.dom.setStyles(r,{"margin-left":"0","margin-right":""})):(i.removeClass("xf_widget_a_right","off"),e.dom.setStyles(r,{"margin-left":"","margin-right":""}));break;default:e.dom.setStyles(r,{"margin-left":"","margin-right":""})}},_show_buttons:function(e,t){var i,n,d=this,o=tinyMCE.activeEditor,r=tinymce.DOM,s=r.getPos(o.getContentAreaContainer()),a=o.dom.getPos(e),g=o.dom.getViewPort(o.getWin());d._define_margin_buttons(o,e),i=Math.max(a.x-g.x,0)+s.x,n=Math.max(a.y-g.y,0)+s.y,r.setStyles(t,{top:n+5+"px",left:i+5+"px",display:"block"}),d.mceTout&&clearTimeout(d.mceTout),d.mceTout=setTimeout(function(){d._hide_buttons()},5e3)},_hide_buttons:function(){this.mceTout&&(document.getElementById("xf_edit_buttons")&&tinymce.DOM.hide("xf_edit_buttons"),clearTimeout(this.mceTout),this.mceTout=0)},getInfo:function(){return{longname:"WP TinyMCE Xtreme Content Widgets",version:tinymce.majorVersion+"."+tinymce.minorVersion}}}),tinymce.PluginManager.add("xtreme_tinymce_widgets",tinymce.plugins.XtremeContentWidgets)}();