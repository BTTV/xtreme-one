var xtreme_dialog_data={action:"",dlg_type:"",filter:"",widget:"",sidebar:"",target_input:"",value:"",s:"",s_media:"all",page:1,content:"standard",perform:"first-page",callback_id:""};var xtreme_dialog_pos={left:0,top:0,width:600};var xtreme_syntax={"not-first":["leave","or","and"],"not-last":["enter","or","and","not"],enter:["enter","not","is_paged","is_preview","is_logged_in","has_role","has_cap","in_postformat","in_category","has_tag","has_author"],leave:["leave","or","and"],or:["enter","not","is_paged","is_preview","is_logged_in","has_role","has_cap","in_postformat","in_category","has_tag","has_author"],and:["enter","not","is_paged","is_preview","is_logged_in","has_role","has_cap","in_postformat","in_category","has_tag","has_author"],not:["is_paged","is_preview","is_logged_in","has_role","has_cap","in_postformat","in_category","has_tag","has_author"],is_paged:["leave","or","and"],is_preview:["leave","or","and"],is_logged_in:["leave","or","and"],has_role:["leave","or","and"],has_cap:["leave","or","and"],in_postformat:["leave","or","and"],in_category:["leave","or","and"],has_tag:["leave","or","and"],has_author:["leave","or","and"]};var xtreme_condition_target=null;(function(a){a(document).ready(function(){a(".x-filter-expander").live("click",function(f){f.preventDefault();a(this).parent().next(".x-filter-section").slideToggle("fast",function(){a("span",f.currentTarget).toggle();if(!a(f.currentTarget).parent().next(".x-filter-section").is(":visible")){a("#x-portlet-editing-close").trigger("click")}})});a(".xtreme-fex a.x-dlg-exceptions").live("click",function(f){f.preventDefault();a("#x-portlet-editing-close").trigger("click");if(a("body").hasClass("iframe")){xtreme_dialog_pos.top=5;xtreme_dialog_pos.left=0;a("form").hide()}else{xtreme_dialog_pos.top=(a(this).offset().top-5)-23;wrapper=a("body").hasClass("widgets_access")?".editwidget":".widget-content";if(a("body").hasClass("rtl")){adjustment=a("body").hasClass("widgets_access")?-250:17;xtreme_dialog_pos.left=parseInt(a(this).closest(wrapper).offset().left)+(parseInt(a(this).closest(wrapper).width())+adjustment)}else{adjustment=a("body").hasClass("widgets_access")?-200:37;xtreme_dialog_pos.left=parseInt(a(this).closest(wrapper).offset().left)-(xtreme_dialog_pos.width+adjustment)}}xtreme_dialog_data.action="edit_widget_filter_exceptions";xtreme_dialog_data.dlg_type=a(this).attr("class");xtreme_dialog_data.filter=a(this).closest(".x-filter").find("label:first input").val();xtreme_dialog_data.widget=a(this).closest(".widget").find(".widget-title h4").text();xtreme_dialog_data.sidebar=a(this).closest(".widgets-holder-wrap").find(".sidebar-name h3").text();xtreme_dialog_data.target_input=a(this).closest(".xtreme-fex").find(".fex-input").attr("name");xtreme_dialog_data.value=a(this).closest(".xtreme-fex").find(".fex-input").val();xtreme_dialog_data.s="";xtreme_dialog_data.s_media="all";xtreme_dialog_data.content=xtreme_dialog_data.value.length==0?"standard":"selection";xtreme_dialog_data.perform="first-page";xtreme_dialog_data.callback_id="";a.post(ajaxurl,xtreme_dialog_data,function(g){a("#x-portlet-editing").html(g).show().css({position:"absolute",width:xtreme_dialog_pos.width+"px",top:xtreme_dialog_pos.top+"px",left:xtreme_dialog_pos.left+"px"})})});a(".x-dlg-media").live("click",function(f){f.preventDefault();a("#x-portlet-editing-close").trigger("click");if(a("body").hasClass("iframe")){xtreme_dialog_pos.top=5;xtreme_dialog_pos.left=0;a("form").hide()}else{wrapper=a("body").hasClass("widgets_access")?".editwidget":".widget-content";xtreme_dialog_pos.top=(a(this).closest(wrapper).find(".x-portlet-wrapper:first").offset().top-5)-13;if(a("body").hasClass("rtl")){adjustment=a("body").hasClass("widgets_access")?-250:17;xtreme_dialog_pos.left=parseInt(a(this).closest(wrapper).offset().left)+(parseInt(a(this).closest(wrapper).width())+adjustment)}else{adjustment=a("body").hasClass("widgets_access")?-200:37;xtreme_dialog_pos.left=parseInt(a(this).closest(wrapper).offset().left)-(xtreme_dialog_pos.width+adjustment)}}if(a("body").hasClass("widgets_access")){a(".editwidget").addClass("widget").attr({id:a("input.widget-id").val()})}xtreme_dialog_data.action="edit_widget_filter_exceptions";xtreme_dialog_data.dlg_type="x-dlg-exceptions";xtreme_dialog_data.filter="is_attachment";xtreme_dialog_data.widget=a(this).closest(".widget").find(".widget-title h4").text();xtreme_dialog_data.sidebar=a(this).closest(".widgets-holder-wrap").find(".sidebar-name h3").text();xtreme_dialog_data.target_input=a(this).closest(".widget").attr("id");xtreme_dialog_data.value="";xtreme_dialog_data.s="";xtreme_dialog_data.s_media="all";xtreme_dialog_data.content=xtreme_dialog_data.value.length==0?"standard":"selection";xtreme_dialog_data.perform="first-page";xtreme_dialog_data.callback_id=a(this).attr("rel");a.post(ajaxurl,xtreme_dialog_data,function(g){a("#x-portlet-editing").html(g).show().css({position:"absolute",width:xtreme_dialog_pos.width+"px",top:xtreme_dialog_pos.top+"px",left:xtreme_dialog_pos.left+"px"})})});a(".xtreme-fex a.x-dlg-expressions").live("click",function(f){f.preventDefault();a("#x-portlet-editing-close").trigger("click");if(a("body").hasClass("iframe")){xtreme_dialog_pos.top=5;xtreme_dialog_pos.left=0;a("form").hide()}else{wrapper=a("body").hasClass("widgets_access")?".editwidget":".widget-content";xtreme_dialog_pos.top=(a(this).offset().top-5)-23;if(a("body").hasClass("rtl")){adjustment=a("body").hasClass("widgets_access")?-250:17;xtreme_dialog_pos.left=parseInt(a(this).closest(wrapper).offset().left)+(parseInt(a(this).closest(wrapper).width())+adjustment)}else{adjustment=a("body").hasClass("widgets_access")?-200:37;xtreme_dialog_pos.left=parseInt(a(this).closest(wrapper).offset().left)-(xtreme_dialog_pos.width+adjustment)}}xtreme_dialog_data.action="edit_widget_filter_expressions";xtreme_dialog_data.dlg_type=a(this).attr("class");xtreme_dialog_data.filter=a(this).closest(".x-filter").find("label:first input").val();xtreme_dialog_data.widget=a(this).closest(".widget").find(".widget-title h4").text();xtreme_dialog_data.sidebar=a(this).closest(".widgets-holder-wrap").find(".sidebar-name h3").text();xtreme_dialog_data.target_input=a(this).closest(".xtreme-fex").find(".fec-input").attr("name");xtreme_dialog_data.value=a(this).closest(".xtreme-fex").find(".fec-input").val();xtreme_dialog_data.s="";xtreme_dialog_data.s_media="all";xtreme_dialog_data.content=xtreme_dialog_data.value.length==0?"standard":"selection";xtreme_dialog_data.perform="first-page";xtreme_dialog_data.callback_id="";a.post(ajaxurl,xtreme_dialog_data,function(g){a("#x-portlet-expression").html(g).show().css({position:"absolute",width:xtreme_dialog_pos.width+"px",top:xtreme_dialog_pos.top+"px",left:xtreme_dialog_pos.left+"px"})})});function b(f){xtreme_dialog_data.perform=f;a.post(ajaxurl,xtreme_dialog_data,function(g){if(xtreme_dialog_data.dlg_type!="x-dlg-exceptions"&&a("#x-portlet-expression").is(":visible")){a("#x-portlet-editing").css({position:"absolute",width:xtreme_dialog_pos.width+"px",top:xtreme_dialog_pos.top+"px",left:xtreme_dialog_pos.left+"px"}).show();a("#x-portlet-expression").hide()}a("#x-portlet-editing").html(g)})}a("#x-portlet-editing #search-submit").live("click",function(f){f.preventDefault();xtreme_dialog_data.s=a("#xtreme-dialog-search-input").val();b("search")});a("#x-portlet-editing #xtreme-dialog-search-input").live("keyup",function(f){f.preventDefault();if(f.which!=13){return}xtreme_dialog_data.s=a(this).val();b("search")});a("#x-portlet-editing .x-media-type").live("click",function(f){f.preventDefault();xtreme_dialog_data.s_media=a(this).attr("rel");b("search")});a("#x-portlet-editing .first-page").live("click",function(f){f.preventDefault();if(a(this).hasClass("disabled")){return}b("first-page")});a("#x-portlet-editing .prev-page").live("click",function(f){f.preventDefault();if(a(this).hasClass("disabled")){return}b("prev-page")});a("#x-portlet-editing .next-page").live("click",function(f){f.preventDefault();if(a(this).hasClass("disabled")){return}b("next-page")});a("#x-portlet-editing .last-page").live("click",function(f){f.preventDefault();if(a(this).hasClass("disabled")){return}b("last-page")});a("#x-portlet-editing .current-page").live("keyup",function(f){f.preventDefault();if(a(this).hasClass("disabled")||f.which!=13){return}xtreme_dialog_data.page=a(this).val();b("this-page")});a("#x-portlet-editing-apply").live("click",function(f){f.preventDefault();b("apply-changes");if(a("body").hasClass("iframe")){a("form").show()}});a("#x-portlet-editing .dlg-selection").live("click",function(f){f.preventDefault();xtreme_dialog_data.content=a(this).attr("id")=="x-portlet-editing-assigned"?"selection":"standard";b("first-page")});a(".fex-maintoggle").live("change",function(g){g.preventDefault();var f=a(this).is(":checked");a(".fex-checkbox").each(function(h,j){if(a(j).is(":checked")!=f){a(j).trigger("click")}})});a(".fex-checkbox").live("change",function(g){g.preventDefault();var j=xtreme_dialog_data.value.length!=0?xtreme_dialog_data.value.split(","):[];if(a(this).is(":checked")){j.push(a(this).val());xtreme_dialog_data.value=j.join(",");a(this).closest("tr").find("td").addClass("fex-selected");a("#x-portlet-editing-selected b").html(j.length)}else{var h=[];for(var f=0;f<j.length;f++){if(j[f]!=a(this).val()){h.push(j[f])}}xtreme_dialog_data.value=h.length==0?"":h.join(",");a(this).closest("tr").find("td").removeClass("fex-selected");a("#x-portlet-editing-selected b").html(h.length)}});function e(){var g=true;var j=a("#x-expression-editor .consumer li").toArray();var h={enter:0,leave:0};a("#x-expression-editor .consumer li").removeClass("error").removeClass("error-blue");for(var f=0;f<j.length;f++){var l=a(j[f]).attr("term");var k=a(j[f+1]).attr("term");if(a.inArray(l,["enter","leave"])!=-1){h[l]=h[l]+1}if(k&&(a.inArray(k,xtreme_syntax[l])==-1)){a(j[f+1]).addClass("error");g=false}}if(j.length>0&&(a.inArray(a(j[0]).attr("term"),xtreme_syntax["not-first"])!=-1)){a(j[0]).addClass("error");g=false}if(j.length>0&&(a.inArray(a(j[j.length-1]).attr("term"),xtreme_syntax["not-last"])!=-1)){a(j[j.length-1]).addClass("error");g=false}if(h.enter!=h.leave){a("#x-expression-editor .consumer li").each(function(m){if(a(this).attr("term")=="enter"){a(this).addClass(h.enter>h.leave?"error":"error-blue")}if(a(this).attr("term")=="leave"){a(this).addClass(h.leave>h.enter?"error":"error-blue")}});g=false}a("#x-expression-editor-apply").toggle(g);return g}function c(){var k=a("#x-expression-editor .consumer li").toArray();var j=[];var h="";for(var g=0;g<k.length;g++){h=a(k[g]).attr("term");d=a(k[g]).find("input").val();if(d){h+=":"+d}j.push(h)}h=j.join("|");a(xtreme_condition_target).val(h);var f=0;a(xtreme_condition_target).closest(".xtreme-fex").find("input").each(function(l,m){if(a(this).val().length>0){f++}});if(f==0){a(xtreme_condition_target).closest(".x-filter").removeClass("fex-selected")}else{a(xtreme_condition_target).closest(".x-filter").addClass("fex-selected")}xtreme_dialog_data.value="";a("#x-portlet-editing-close").trigger("click");a("body").trigger("visualize_filter_state")}a(".consumer a.del").live("click",function(f){f.preventDefault();a(this).closest("li").remove();e()});a(".consumer a.edit").live("click",function(f){f.preventDefault();a(this).closest("li").find("input").attr("name","current-condition");xtreme_dialog_data.target_input="current-condition";xtreme_dialog_data.action="edit_widget_filter_exceptions";xtreme_dialog_data.filter=a(this).closest("li").attr("term");xtreme_dialog_data.s="";xtreme_dialog_data.value=a(this).closest("li").find("input").val();xtreme_dialog_data.content=xtreme_dialog_data.value.length==0?"standard":"selection";b("first-page")});a("#x-expression-editor-reset").live("click",function(f){f.preventDefault();a("#x-expression-editor .consumer li").remove()});a("#x-expression-editor-apply").live("click",function(f){f.preventDefault();if(e()){c()}});a("#x-portlet-editing-back").live("click",function(f){f.preventDefault();a("#x-portlet-editing").hide();a("#x-portlet-expression").show();a('input[name="'+xtreme_dialog_data.target_input+'"]').attr("name","")});a("#x-portlet-expression").live("check-syntax",e)})})(jQuery);